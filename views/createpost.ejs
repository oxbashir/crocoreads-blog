<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/createpost.css" />
    <title>Create New Post</title>
  </head>

  <body>
    <form id="createPostForm" enctype="multipart/form-data">
      <h2>Create new post</h2>

      <div>
        <input
          class="post-title"
          type="text"
          name="title"
          required
          placeholder="Title"
        />
      </div>

      <div>
        <textarea
          class="post-content"
          name="content"
          rows="10"
          cols="50"
          required
          placeholder="Content"
        ></textarea>
      </div>

      <br />

      <div>
        <label>Image (optional)</label><br />
        <label for="imageUpload" class="upload-btn">Select Image</label>
        <input
          id="imageUpload"
          class="post-image"
          type="file"
          name="image"
          accept="image/*"
          hidden
        />
      </div>

      <br />
      <button type="submit">Create</button>
    </form>

    <script>
      const form = document.getElementById("createPostForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const token = localStorage.getItem("token"); // JWT stored on login

        try {
          const res = await fetch("/posts/create", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          });

          const data = await res.json();

          if (res.ok) {
            window.location.href = "/";
          } else {
            alert(data.message || "Failed to create post");
          }
        } catch (err) {
          console.error(err);
          alert("Error submitting post");
        }
      });
    </script>
  </body>
</html>
