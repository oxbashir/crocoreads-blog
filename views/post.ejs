<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= post.title %></title>
    <link rel="stylesheet" href="/css/post.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-left">
        <a href="/" class="logo">
          <img src="/assets/logo.png" alt="" class="logo-img" />crocoreads
        </a>
      </div>

      <div class="nav-right">
        <a href="/createpost" id="createPostBtn" class="nav-btn"> Write </a>
        <button id="logoutBtn" class="nav-btn logout">Logout</button>
      </div>
    </nav>

    <div class="post-container">
      <h1 class="post-title"><%= post.title %></h1>
      <p>
        <span class="post-author">
          <%= post.author ? post.author.name : "Unknown" %>
        </span>
        <span class="separator"> | </span>
        <span class="post-date">
          <%= post.createdAt.toLocaleDateString("en-US", { month: "short", day:
          "2-digit", year: "numeric" }) %>
        </span>
      </p>

      <% if (post.image) { %>
      <img src="<%= post.image %>" alt="Post Image" class="post-image" />
      <% } %>

      <div class="post-content">
        <p><%= post.content %></p>
      </div>

      <a href="/" class="back-link">‚Üê Back to Home</a>
    </div>

    <script>
      const logoutBtn = document.getElementById("logoutBtn");
      const createPostBtn = document.getElementById("createPostBtn");

      // Show logout button only if user is logged in
      const token = localStorage.getItem("token");
      if (!token) {
        logoutBtn.style.display = "none";
      }

      // Logout
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("token");
        window.location.href = "/login";
      });

      // Create Post check
      createPostBtn.addEventListener("click", (e) => {
        e.preventDefault(); // prevent normal link behavior

        if (token) {
          // logged in
          window.location.href = "/createpost";
        } else {
          // not logged in
          window.location.href = "/login";
        }
      });
    </script>
  </body>
</html>
